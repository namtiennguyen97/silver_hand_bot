<!doctype html>
<html lang="vi">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Chatbot SAO-ƒê√äM ‚Äî Demo Gamer Dark</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
	<style>
		:root{
			--bg:#0b0f13;
			--panel:#071018;
			--accent:#6ee7b7; /* mint */
			--accent-2:#7c3aed; /* purple */
			--muted:#9aa5b1;
			--glass: rgba(255,255,255,0.03);
			--danger:#ff6b6b;
		}
		*{box-sizing:border-box}
		html,body{height:100%}
		body{
			margin:0;
			font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
			background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.08), transparent 8%),
			radial-gradient(1000px 500px at 90% 90%, rgba(110,231,183,0.03), transparent 8%),
			var(--bg);
			color:#e6eef3;
			-webkit-font-smoothing:antialiased;
			-moz-osx-font-smoothing:grayscale;
			padding:20px;
			display:flex;
			align-items:center;
			justify-content:center;
		}
		
		.container{
			width:100%;
			max-width:1100px;
			height:calc(100vh - 40px);
			display:grid;
			grid-template-columns: 360px 1fr;
			gap:20px;
		}
		
		/* left sidebar */
		.sidebar{
			background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
			border:1px solid rgba(255,255,255,0.03);
			border-radius:14px;
			padding:18px;
			display:flex;
			flex-direction:column;
			gap:12px;
			box-shadow: 0 8px 30px rgba(0,0,0,0.6);
		}
		.brand{
			display:flex;gap:12px;align-items:center;
		}
		.logo{
			width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;
			background:linear-gradient(135deg,var(--accent),var(--accent-2));font-weight:800;font-size:18px;color:#021017;
			box-shadow: 0 6px 18px rgba(124,58,237,0.18), inset 0 -6px 18px rgba(255,255,255,0.03);
		}
		h1{font-size:14px;margin:0}
		p.subtitle{margin:0;color:var(--muted);font-size:13px}
		
		.history{flex:1;overflow:auto;padding-right:6px}
		.chat-item{padding:10px;border-radius:10px;display:flex;gap:10px;align-items:flex-start;cursor:pointer}
		.chat-item:hover{background:rgba(255,255,255,0.01)}
		.chat-item .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-2));flex:0 0 10px}
		.chat-item .meta{font-size:13px;color:var(--muted)}
		
		.controls{display:flex;gap:8px}
		.btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;font-size:13px;color:var(--muted);cursor:pointer}
		.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021017;border:none}
		
		/* main panel */
		.panel{
			background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
			border-radius:14px;border:1px solid rgba(255,255,255,0.03);padding:14px;display:flex;flex-direction:column;overflow:hidden;
			box-shadow: 0 10px 40px rgba(0,0,0,0.6);
		}
		
		.topbar{display:flex;align-items:center;justify-content:space-between;padding:6px 4px}
		.topbar .title{font-weight:700}
		.topbar .status{font-size:13px;color:var(--muted)}
		
		.chat-area{flex:1;display:flex;gap:14px;align-items:stretch}
		
		/* Canvas side */
		.canvas-wrap{flex:1;position:relative;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:12px;display:flex;flex-direction:column}
		canvas{border-radius:12px;background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(255,255,255,0.02));width:100%;height:100%;display:block}
		
		/* text-history side */
		.text-wrap{width:340px;display:flex;flex-direction:column;gap:8px}
		.messages{flex:1;overflow:auto;padding:8px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02)}
		.msg{padding:10px;border-radius:10px;margin-bottom:8px;font-size:14px}
		.msg.user{align-self:flex-end;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021017}
		.msg.assistant{align-self:flex-start;background:rgba(255,255,255,0.02);color:#e6eef3;border:1px solid rgba(255,255,255,0.02)}
		
		.composer{display:flex;gap:8px;padding-top:8px}
		textarea#prompt{flex:1;min-height:48px;max-height:120px;border-radius:12px;padding:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;resize:none}
		button#send{width:78px;border-radius:12px;border:none;padding:10px;font-weight:700;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021017}
		
		.small{font-size:12px;color:var(--muted)}
		
		/* responsive */
		@media (max-width:980px){
			.container{grid-template-columns:1fr;height:auto}
			.text-wrap{width:100%}
			.chat-area{flex-direction:column}
			.canvas-wrap{height:420px}
		}
	</style>
</head>
<body>
<div class="container">
	<aside class="sidebar">
		<div class="brand">
			<div class="logo">SD</div>
			<div>
				<h1>SAO-ƒê√äM ‚Äî Chat Demo</h1>
				<p class="subtitle">Gamer dark theme ‚Ä¢ Responsive ‚Ä¢ Canvas chat</p>
			</div>
		</div>
		
		<div class="controls">
			<button class="btn" id="newConv">+ T·∫°o m·ªõi</button>
			<button class="btn" id="export">Xu·∫•t</button>
			<button class="btn" id="clear">X√≥a</button>
		</div>
		
		<div class="history" id="historyList" aria-live="polite">
			<!-- conversation list will be injected -->
		</div>
		
		<div class="small">Tip: B·∫•m 1 m·ª•c trong l·ªãch s·ª≠ ƒë·ªÉ load l·∫°i cu·ªôc h·ªôi tho·∫°i.</div>
	</aside>
	
	<main class="panel">
		<div class="topbar">
			<div class="title">ü§ñ Chatbot SAO-ƒê√äM</div>
			<div class="status" id="status">Offline</div>
		</div>
		
		<div class="chat-area">
			<div class="canvas-wrap">
				<canvas id="chatCanvas"></canvas>
			</div>
			
			<div class="text-wrap">
				<div class="messages" id="messagesBox" role="log" aria-live="polite">
					<!-- text messages -->
				</div>
				
				<div class="composer">
					<textarea id="promptInput" rows="2" placeholder="Nh·∫≠p c√¢u h·ªèi... (Nh·∫•n Shift+Enter xu·ªëng d√≤ng)"></textarea>
					<button id="sendBtn">G·ª≠i</button>
				</div>
			</div>
		</div>
	
	</main>
</div>

<script>
	// Simple in-memory conversation manager
	const conversationList = []; // array of {id, title, messages}
	let currentConversation = { id: genId(), title: 'Cu·ªôc tr√≤ chuy·ªán m·ªõi', messages: [] };
	
	const historyListEl = document.getElementById('historyList');
	const messagesBox = document.getElementById('messagesBox');
	const statusEl = document.getElementById('status');
	const promptInput = document.getElementById('promptInput');
	const sendBtn = document.getElementById('sendBtn');
	
	// Canvas setup
	const canvas = document.getElementById('chatCanvas');
	const ctx = canvas.getContext('2d');
	function resizeCanvas(){
		const rect = canvas.getBoundingClientRect();
		canvas.width = Math.floor(rect.width * devicePixelRatio);
		canvas.height = Math.floor(rect.height * devicePixelRatio);
		ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
		renderCanvas();
	}
	window.addEventListener('resize', resizeCanvas);
	
	// Utility
	function genId(){return Math.random().toString(36).slice(2,9)}
	
	function addHistory(conv){
		// push to list and render
		conversationList.unshift(conv);
		renderHistory();
	}
	
	function renderHistory(){
		historyListEl.innerHTML='';
		conversationList.forEach(conv => {
			const item = document.createElement('div');
			item.className='chat-item';
			item.innerHTML = `<div class="dot"></div><div class="meta"><div style=\"font-weight:600\">${escapeHtml(conv.title)}</div><div style=\"font-size:12px;color:var(--muted)\">${conv.messages.length} tin nh·∫Øn</div></div>`;
			item.onclick = ()=>{ loadConversation(conv.id); };
			historyListEl.appendChild(item);
		});
	}
	
	function loadConversation(id){
		const found = conversationList.find(c=>c.id===id);
		if(found){
			currentConversation = JSON.parse(JSON.stringify(found));
			// move it to top
			const idx = conversationList.findIndex(c=>c.id===id);
			if(idx> -1) conversationList.splice(idx,1);
			conversationList.unshift(found);
			renderHistory();
			renderMessages();
			renderCanvas();
		}
	}
	
	function renderMessages(){
		messagesBox.innerHTML='';
		currentConversation.messages.forEach(m => {
			const d = document.createElement('div');
			d.className = 'msg ' + (m.role === 'user' ? 'user' : 'assistant');
			d.textContent = m.content;
			messagesBox.appendChild(d);
		});
		messagesBox.scrollTop = messagesBox.scrollHeight;
	}
	
	function escapeHtml(s){return String(s).replace(/[&<>"']/g,function(c){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]})}
	
	// send flow
	async function sendMessage(){
		const text = promptInput.value.trim();
		if(!text) return;
		const userMsg = {role:'user', content:text};
		currentConversation.messages.push(userMsg);
		promptInput.value='';
		renderMessages();
		renderCanvas();
		
		// Optimistic UI: show pending assistant message
		const pending = {role:'assistant', content:'‚è≥ ƒêang x·ª≠ l√Ω...'};
		currentConversation.messages.push(pending);
		renderMessages();
		renderCanvas();
		
		try{
			statusEl.textContent='K·∫øt n·ªëi...';
			// call backend - adapt to your server API
			const resp = await fetch('/api/chat', {
				method:'POST', headers:{'Content-Type':'application/json'},
				body: JSON.stringify({ messages: currentConversation.messages.filter(m=>m.role!=='assistant' || m.content!=='‚è≥ ƒêang x·ª≠ l√Ω...') })
			});
			const data = await resp.json();
			if(!resp.ok){
				pending.content = '‚ö†Ô∏è L·ªói server: ' + (data?.error || resp.statusText);
			} else {
				const reply = data.choices?.[0]?.message?.content || data.reply || 'Kh√¥ng c√≥ ph·∫£n h·ªìi.';
				pending.content = reply;
			}
		}catch(err){
			console.error(err);
			pending.content = '‚ö†Ô∏è L·ªói khi g·ªçi API: ' + (err.message || err);
		}finally{
			statusEl.textContent='Online';
			// persist this conversation to history (or update existing)
			// if new conv not yet in list, add
			const exists = conversationList.find(c=>c.id===currentConversation.id);
			if(!exists){
				currentConversation.title = currentConversation.messages[0]?.content?.slice(0,40) || currentConversation.title;
				addHistory(JSON.parse(JSON.stringify(currentConversation)));
			} else {
				// update history top item
				conversationList[0] = JSON.parse(JSON.stringify(currentConversation));
			}
			renderMessages();
			renderCanvas();
		}
	}
	
	sendBtn.addEventListener('click', sendMessage);
	promptInput.addEventListener('keydown', (e)=>{
		if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
	});
	
	document.getElementById('newConv').addEventListener('click', ()=>{
		currentConversation = { id: genId(), title: 'Cu·ªôc tr√≤ chuy·ªán m·ªõi', messages: [] };
		renderMessages(); renderCanvas();
	});
	
	document.getElementById('clear').addEventListener('click', ()=>{
		if(confirm('X√≥a m·ªçi l·ªãch s·ª≠?')){ conversationList.length=0; renderHistory(); currentConversation = { id: genId(), title:'Cu·ªôc tr√≤ chuy·ªán m·ªõi', messages:[] }; renderMessages(); renderCanvas(); }
	});
	
	document.getElementById('export').addEventListener('click', ()=>{
		const text = JSON.stringify(currentConversation, null, 2);
		const blob = new Blob([text], {type:'application/json'});
		const url = URL.createObjectURL(blob);
		const a = document.createElement('a'); a.href = url; a.download = (currentConversation.title||'conv') + '.json'; a.click();
		URL.revokeObjectURL(url);
	});
	
	// Canvas renderer ‚Äî draws conversation as stylized bubbles
	function renderCanvas(){
		const w = canvas.width / devicePixelRatio;
		const h = canvas.height / devicePixelRatio;
		ctx.clearRect(0,0,w,h);
		
		// background grid / accents
		drawBackground(w,h);
		
		// draw bubbles from bottom up
		const padding = 18;
		const maxWidth = Math.min(520, w - 220);
		let y = h - padding;
		const msgs = currentConversation.messages.slice().reverse();
		
		ctx.font = '14px Inter, system-ui, sans-serif';
		
		for(const m of msgs){
			const isUser = m.role === 'user';
			const text = m.content || '';
			const lines = wrapText(ctx, text, maxWidth - 28);
			const lineHeight = 18;
			const bubbleH = lines.length * lineHeight + 20;
			const bubbleW = Math.min(maxWidth, measureLinesWidth(ctx, lines) + 28);
			y -= bubbleH + 12;
			const x = isUser ? w - padding - bubbleW : padding + 8;
			
			// shadow
			ctx.beginPath();
			roundRect(ctx, x, y, bubbleW, bubbleH, 12);
			ctx.fillStyle = isUser ? 'rgba(124,58,237,0.14)' : 'rgba(255,255,255,0.02)';
			ctx.fill();
			
			// inner gradient / fill
			if(isUser){
				const g = ctx.createLinearGradient(x,y,x+bubbleW,y+bubbleH);
				g.addColorStop(0,'rgba(110,231,183,0.12)');
				g.addColorStop(1,'rgba(124,58,237,0.12)');
				ctx.fillStyle = g; ctx.globalCompositeOperation = 'lighter'; ctx.fill(); ctx.globalCompositeOperation='source-over';
			}
			
			// text
			ctx.fillStyle = isUser ? '#021017' : '#e6eef3';
			ctx.font = '600 13px Inter, system-ui';
			const textX = x + 14;
			let ty = y + 16;
			ctx.font = '600 13px Inter, system-ui';
			for(const line of lines){
				ctx.fillText(line, textX, ty);
				ty += lineHeight;
			}
			
			// small timestamp / role tag
			ctx.font = '11px Inter, system-ui';
			ctx.fillStyle = 'rgba(255,255,255,0.18)';
			ctx.fillText(isUser ? 'B·∫°n' : 'Bot', textX, y + bubbleH - 6);
			
			// stop if offscreen
			if(y < 0) break;
		}
		
		// subtle UI glow
		ctx.fillStyle = 'rgba(124,58,237,0.06)';
		ctx.fillRect(8,8,80,6);
	}
	
	function drawBackground(w,h){
		// draw faint grid lines
		ctx.save();
		ctx.fillStyle = 'rgba(255,255,255,0.01)';
		ctx.fillRect(0,0,w,h);
		for(let i=0;i<6;i++){
			ctx.beginPath(); ctx.moveTo(0,h/6*i); ctx.lineTo(w,h/6*i); ctx.lineWidth = 1; ctx.strokeStyle = 'rgba(255,255,255,0.01)'; ctx.stroke();
		}
		ctx.restore();
	}
	
	function wrapText(context, text, maxWidth){
		const words = text.split(/\s+/);
		const lines = [];
		let line = '';
		for(let n=0;n<words.length;n++){
			const test = line + (line? ' ':'') + words[n];
			const metrics = context.measureText(test);
			if(metrics.width > maxWidth && line){ lines.push(line); line = words[n]; } else { line = test; }
		}
		if(line) lines.push(line);
		// also if lines too long, further split
		return lines;
	}
	
	function measureLinesWidth(ctx, lines){
		let max = 0;
		for(const l of lines){ max = Math.max(max, ctx.measureText(l).width); }
		return max;
	}
	
	function roundRect(ctx, x, y, w, h, r){
		ctx.beginPath();
		ctx.moveTo(x+r,y);
		ctx.arcTo(x+w,y,x+w,y+h,r);
		ctx.arcTo(x+w,y+h,x,y+h,r);
		ctx.arcTo(x,y+h,x,y,r);
		ctx.arcTo(x,y,x+w,y,r);
		ctx.closePath();
	}
	
	// initialize
	function init(){
		// seed with a welcome message
		currentConversation.messages.push({role:'assistant', content:'Xin ch√†o! M√¨nh l√† Chatbot SAO-ƒê√äM. H√£y nh·∫≠p c√¢u h·ªèi v√† ·∫•n G·ª≠i.'});
		renderMessages();
		resizeCanvas();
		statusEl.textContent='Online';
	}
	
	init();
</script>
</body>
</html>
